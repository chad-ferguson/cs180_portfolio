<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Project 1 — Prokudin-Gorskii Colorization</title>
  <link rel="stylesheet" href="project.css" />
  <meta name="description" content="CS180 Project 1: Colorizing the Prokudin-Gorskii Photo collection" />
</head>
<body>
  <header class="site-header container">
    <nav class="breadcrumb">
      <a href="../../index.html">← Back to Portfolio</a>
    </nav>

    <h1>Project 1: Colorizing the Prokudin-Gorskii Photo Collection</h1>
    <div class="rule"></div>

    <!-- Quick links -->
    <div class="quick-links" role="navigation" aria-label="Jump to section">
      <a class="btn" href="#overview">Overview</a>
      <a class="btn" href="#lowres">Low-Res Results</a>
      <a class="btn" href="#highres">High-Res Results</a>
      <a class="btn" href="#chosen">Chosen Examples</a>
      <a class="btn" href="#troubleshoot">Troubleshooting</a>
    </div>
  </header>

  <main class="container article">
    <!-- Approach -->
    <section id="overview" class="section">
      <h2>Overview</h2>
      <p>
        The goal of this project is to split Prokudin-Gorskii's glass plates into B/G/R channels, align the channels with x and y shifts, and stack them into a colored image. I implemented both single-scale and multi-scale approaches to accomplish this goal, described more in depth in the section below.
      </p>
    </section>

    <!-- Low-res results -->
    <section id="lowres" class="section">
      <h2>Low-Res Results (Single-Scale)</h2>
      <p>
        For low-res images, a single-scale approach is sufficient. For this, I did a small windowed search grid over integer shifts and picked the alignment that best matches the interior of the image, which is the alignment with the best NCC over the raw pixels. The NCC, or normalized cross correlation, measures the similarity between the images, giving a score between -1 and 1. I also attempted everything with L2 distance metric, but I found NCC to work slightly better. The search space for the results below is ±15 pixels, also cropping out the borders before scoring so the borders don't dominate the metric. This is applied to the three .jpg files in the given data.
      </p>
      <div class="gallery">
        
        <figure class="card">
          <div class="media-frame">
            <img src="media/low_res/colorized_cathedral.jpg" alt="cathedral.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">cathedral.jpg</div>
            <ul class="offsets">
              <li>G → B: <code>x=+2</code>, <code>y=+5</code></li>
              <li>R → B: <code>x=+3</code>, <code>y=+12</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/low_res/colorized_monastery.jpg" alt="monastery.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">monastery.jpg</div>
            <ul class="offsets">
              <li>G → B: <code>x=+2</code>, <code>y=-3</code></li>
              <li>R → B: <code>x=+2</code>, <code>y=+3</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/low_res/colorized_tobolsk.jpg" alt="tobolsk.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">tobolsk.jpg</div>
            <ul class="offsets">
              <li>G → B: <code>x=+3</code>, <code>y=+3</code></li>
              <li>R → B: <code>x=+3</code>, <code>y=+6</code></li>
            </ul>
          </figcaption>
        </figure>
      </div>
    </section>

    <!-- Example results -->
    <section id="highres" class="section">
      <h2>High-Res Results (Pyramid)</h2>
      <p>
        For the larger, high-res scans, it is necessary to use a coarse-to-fine pyramid speed-up. I built a 2x downsampled pyramid until the image is small (~120 px on the shortest side), solve at the coarsest level with a ±50 pixel range, then double the estimate and refine with a small search (±5 px) at each finer level. Once again, we crop 25% of the exterior to get rid of borders. The metrics for the images below use NCC on the raw pixels as well. This is applied for all of the various .tif files in the given data and chosen from the archive. The only clear defect is emir.tif, but this is addressed later in the troubleshooting section.
      </p>
      <div class="gallery">
        
        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_church.jpg" alt="church.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">church.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+4</code>, <code>y=+25</code></li>
              <li>R → B: <code>x=-4</code>, <code>y=+58</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_emir.jpg" alt="emir.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">emir.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+24</code>, <code>y=+48</code></li>
              <li>R → B: <code>x=-473</code>, <code>y=-280</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_harvesters.jpg" alt="harvesters.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">harvesters.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+17</code>, <code>y=+59</code></li>
              <li>R → B: <code>x=+14</code>, <code>y=+123</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_icon.jpg" alt="icon.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">icon.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+17</code>, <code>y=+41</code></li>
              <li>R → B: <code>x=+23</code>, <code>y=+89</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_italil.jpg" alt="italil.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">italil.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+21</code>, <code>y=+38</code></li>
              <li>R → B: <code>x=+36</code>, <code>y=+77</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_lastochikino.jpg" alt="lastochikino.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">lastochikino.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=-2</code>, <code>y=-3</code></li>
              <li>R → B: <code>x=-8</code>, <code>y=+75</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_lugano.jpg" alt="lugano.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">lugano.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=-16</code>, <code>y=+41</code></li>
              <li>R → B: <code>x=-29</code>, <code>y=+93</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_melons.jpg" alt="melons.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">melons.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+10</code>, <code>y=+82</code></li>
              <li>R → B: <code>x=+13</code>, <code>y=+178</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_self_portrait.jpg" alt="self_portrait.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">self_portrait.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+29</code>, <code>y=+78</code></li>
              <li>R → B: <code>x=+37</code>, <code>y=+175</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_siren.jpg" alt="siren.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">siren.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=-5</code>, <code>y=+49</code></li>
              <li>R → B: <code>x=-24</code>, <code>y=+97</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_three_generations.jpg" alt="three_generations.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">three_generations.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+14</code>, <code>y=+51</code></li>
              <li>R → B: <code>x=+12</code>, <code>y=+110</code></li>
            </ul>
          </figcaption>
        </figure>
      </div>
    </section>

    <!-- Chosen examples -->
    <section id="chosen" class="section">
      <h2>Chosen Examples</h2>
      <p>
        Here are the results of running the multi-scale approach on a few images chosen from the archive.
      </p>
      <div class="gallery">
        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_chosen/colorized_textile_mill.jpg" alt="textile_mill.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">textile_mill.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+27</code>, <code>y=+72</code></li>
              <li>R → B: <code>x=+34</code>, <code>y=+135</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_chosen/colorized_railroad_construction.jpg" alt="railroad_construction.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">railroad_construction.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=-14</code>, <code>y=+34</code></li>
              <li>R → B: <code>x=-26</code>, <code>y=+121</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_chosen/colorized_mozhaiskii_nikolaevskii.jpg" alt="mozhaiskii_nikolaevskii.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">mozhaiskii_nikolaevskii.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+15</code>, <code>y=+41</code></li>
              <li>R → B: <code>x=+25</code>, <code>y=+92</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_chosen/colorized_lizhma_river.jpg" alt="lizhma_river.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">lizhma_river.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=-1</code>, <code>y=+37</code></li>
              <li>R → B: <code>x=0</code>, <code>y=+127</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_chosen/colorized_wood_carving.jpg" alt="wood_carving.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">wood_carving.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=0</code>, <code>y=+52</code></li>
              <li>R → B: <code>x=-13</code>, <code>y=+126</code></li>
            </ul>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_chosen/colorized_religious_painting.jpg" alt="religious_painting.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">religious_painting.tif</div>
            <ul class="offsets">
              <li>G → B: <code>x=+3</code>, <code>y=+29</code></li>
              <li>R → B: <code>x=+7</code>, <code>y=+69</code></li>
            </ul>
          </figcaption>
        </figure>
      </div>
    </section>

    <!-- Troubleshooting -->
    <section id="troubleshoot" class="section">
      <h2>Troubleshooting</h2>
      <p class="lede">
        While all of the other .tif images worked fairly well with the pyramid approach on raw pixels as features, I had trouble trying to get emir.tif aligned. As mentioned in the spec, the brightness difference between channels might be causing the problems. I decided to add an option to use gradient magnitude instead of raw pixels as the feature, which fixed this misalignment. The same pyramid algorithm is run, just on the "derivatives" on the image, looking for edges and aligning to that instead of on raw pixels. I think I would classify this as both "bells & whistles" and troubleshooting. I just wanted to get emir.tif aligned well. The image before and after the feature update are shown below.
      </p>

      <figure class="figure compare">
        <div class="pane">
          <div class="media-frame">
            <img src="media/high_res_rgb/colorized_emir.jpg"
                alt="emir.tif — before (misaligned)" loading="lazy">
          </div>
          <figcaption>
            <div class="title">Emir Before</div>
            <ul class="offsets">
              <li>G → B: <code>x=+24</code>, <code>y=+48</code></li>
              <li>R → B: <code>x=-473</code>, <code>y=-280</code></li>
            </ul>
          </figcaption>
        </div>

        <div class="arrow" aria-hidden="true">→</div>

        <div class="pane">
          <div class="media-frame">
            <img src="media/high_res_edge/colorized_emir_after.jpg"
                alt="emir.tif — after (gradient-based matching)" loading="lazy">
          </div>
          <figcaption>
            <div class="title">Emir After</div>
            <ul class="offsets">
              <li>G → B: <code>x=+24</code>, <code>y=+49</code></li>
              <li>R → B: <code>x=+40</code>, <code>y=+107</code></li>
            </ul>
          </figcaption>
        </div>

      </figure>
      <p class="lede">
        Although emir.tif was the only image that caused major trouble, this updated gradient feature did align the other images slightly better, typically by just a few pixels (if any). Here are the results of using this new feature of a few other images.</p>
      <div class="gallery">
        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_edge/colorized_three_generations.jpg" alt="three_generations.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">three_generations.tif</div>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_edge/colorized_italil.jpg" alt="italil.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">italil.tif</div>
          </figcaption>
        </figure>

        <figure class="card">
          <div class="media-frame">
            <img src="media/high_res_edge/colorized_harvesters.jpg" alt="harvesters.jpg" loading="lazy">
          </div>
          <figcaption>
            <div class="title">harvesters.tif</div>
          </figcaption>
        </figure>
      </div>
    </section>
  </main>
</body>
</html>
